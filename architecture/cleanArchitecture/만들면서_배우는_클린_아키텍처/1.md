# 계층형 아키텍처의 문제는 무엇일까?

    아키텍처의 전부는 변화하는 요구사항과 외부 요인에 빠르게 적용할 수 있게 해주는 것이다 - Uncle Bob
규칙을 가지고 이후 변화하는 상황을 감당할 수 있는 것 그것을 가능케 하는 것은 아키텍처라 소개합니다. 따라 잘 만들어진 계층형 아키텍처는 견고한 아키텍처 패턴이기 때문에 잘 구성하면 각 계층이 서로 영향을 받지 않게 잘 만들 수 있습니다.

그럼 어떤 문제점이 존재하기 때문에 계층형 아키텍처를 사용하였을 때 어떤 문제가 발생하게 되는 것일까?

우선 그 첫번째 스타트는 계층형 아키텍처는 보통 **데이터베이스 주도 설계**를 유도하게 된다.

그 이유가 무엇일까?

우리는 계층형 아키텍처에 대해 이해를 해볼 필요가 있다.

계층형 아키텍처는 보통 **웹** -> **도메인** -> **영속성** 방향으로 의존관계를 형성하고 있다. 그렇기 때문에 어플리케이션은 결국 영속성 계층을 토대로 구축되게 된다.

영속성 계층을 토대로 구축한 것이 잘못된 것인가? 라고 묻는다면 우리는 계층형 아키텍처를 선택하였기 때문에 의존 관계의 끝에 위치한 영속성 계층을 바라보는 것은 잘못된 방향이 아니다.

그럼 왜 문제가 발생하는가? 이는 우리의 목적이 무엇인지 바라봐야한다.  

우리는 애플리케이션을 만들 때 **행동**을 중심으로 모델링을 하게된다.

이런 행동을 주관하는 계층은 무엇인가? 바로 도메인 계층이다.

이때 문제가 발생할 수 있다. 우리는 행동 기반의 비즈니스 규칙들을 정의하게 되지만, 데이터베이스 주도 설계 즉 **상태**가 주도권을 가지고 있어 비즈니스 규칙들을 변경 확장을 하게 될 때 문제가 발생하게 된다.

왜 비즈니스 규칙들을 변경 확장을 할 때 문제가 발생하게 될까?

이는 고민을 해볼 필요성이 있어 보인다. 우리는 영속성 계층의 주도하에 도메인 모델을 정의할 것이다.

이렇게 되면 도메인 계층은 영속성 계층과의 강한 의존관계를 형성하게 될 것이고,  
그 때문에 도메인 로직을 변경, 확장을 할 때 영속성 계층의 간섭을 받을 수 있다.

다른 문제로는 **테스트**에 어려움이 생긴다.

계층형 아키텍처를 사용하다보면 웹 계층에서 영속성 계층을 의존하게 만들 수도 있다. (여기서부터 잘못 되었다 생각한다.)  
이럴때 테스트를 하기는 어려운 상황이 발생 할 것이다.

비즈니스 로직이 존재하는 계층의 경계가 모호해지는 상황이 발생 할 수 있다는 의미이다.

또한 확장되는 기능들에 따라 도메인 계층의 Service가 너무 거대해질 수가 있다.  
이럴경우 이 큰 서비스는 많은 영속성 계층에 의존성을 가지게 될 것이고, 이는 결국 서비스의 정체성에 혼란을 야기할 수 있다.

위에서 설명한 내용들이 결국 계층형 아키텍처를 사용하기에 발생하는 문제인가?  
맞을 수도 있다. 다만 계층형 아키텍처를 변형 시킴으로써 발생하는 문제들도 있는 것으로, 이는 계층형 아키텍처가 데이터베이스 주도 개발을 하게 유도하기 때문에 발생한 상황일 수도 있다 생각한다.


